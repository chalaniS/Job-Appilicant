{"version":3,"names":["_v8flags","require","_path","_child_process","_url","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_interopRequireWildcard","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","path","join","dirname","__filename","babelArgs","process","argv","slice","userArgs","argSeparator","indexOf","getNormalizedV8Flag","matches","match","replace","aliases","Map","getV8Flags","v8Flags","map","allowedNodeEnvironmentFlags","forEach","flag","push","v8FlagsSet","Set","i","length","split","unshift","kexec","code","shouldPassthroughIPC","send","proc","child_process","spawn","stdio","on","signal","kill","pid","exitCode","message"],"sources":["../src/babel-node.ts"],"sourcesContent":["/**\n * This tiny wrapper file checks for known node flags and appends them\n * when found, before invoking the \"real\" _babel-node(1) executable.\n */\n\nimport getV8Flags from \"v8flags\";\nimport path from \"path\";\nimport child_process from \"child_process\";\nimport { fileURLToPath } from \"url\";\n\nconst args = [\n  path.join(path.dirname(fileURLToPath(import.meta.url)), \"_babel-node\"),\n];\n\nlet babelArgs = process.argv.slice(2);\nlet userArgs: string[];\n\n// separate node arguments from script arguments\nconst argSeparator = babelArgs.indexOf(\"--\");\nif (argSeparator > -1) {\n  userArgs = babelArgs.slice(argSeparator); // including the  --\n  babelArgs = babelArgs.slice(0, argSeparator);\n}\n\n/**\n * Replace underscores with dashes in the v8Flag name\n * Also ensure that if the arg contains a value (e.g. --arg=true)\n * that only the flag is returned.\n */\nfunction getNormalizedV8Flag(arg: string) {\n  // v8 uses the \"no\" prefix to negate boolean flags (e.g. --nolazy),\n  // but they are not listed by v8flags\n  const matches = arg.match(/--(?:no)?(.+)/);\n\n  if (matches) {\n    return `--${matches[1].replace(/_/g, \"-\")}`;\n  }\n\n  return arg;\n}\n\n// These are aliases for node options defined by babel-node.\n// TODO(Babel 8): Consider removing these\nconst aliases = new Map([\n  [\"-d\", \"--debug\"],\n  [\"-gc\", \"--expose-gc\"],\n]);\n\ngetV8Flags(async function (err, v8Flags) {\n  if (!process.env.BABEL_8_BREAKING) {\n    // The version of v8flags used by Babel 7 uses _, while the one used\n    // by Babel 8 used -. Normalize the flags accordingly.\n    v8Flags = v8Flags.map(getNormalizedV8Flag);\n    process.allowedNodeEnvironmentFlags.forEach(flag =>\n      v8Flags.push(getNormalizedV8Flag(flag)),\n    );\n  }\n\n  const v8FlagsSet = new Set(v8Flags);\n\n  for (let i = 0; i < babelArgs.length; i++) {\n    const arg = babelArgs[i];\n    const flag = arg.split(\"=\")[0];\n\n    if (flag === \"-r\" || flag === \"--require\") {\n      args.push(flag);\n      args.push(babelArgs[++i]);\n    } else if (aliases.has(flag)) {\n      args.unshift(aliases.get(flag));\n    } else if (\n      flag === \"debug\" || // node debug foo.js\n      flag === \"inspect\" ||\n      v8FlagsSet.has(getNormalizedV8Flag(flag))\n    ) {\n      args.unshift(arg);\n    } else {\n      args.push(arg);\n    }\n  }\n\n  // append arguments passed after --\n  if (argSeparator > -1) {\n    args.push(...userArgs);\n  }\n\n  try {\n    const { default: kexec } = await import(\"kexec\");\n    kexec(process.argv[0], args);\n  } catch (err) {\n    if (\n      err.code !== \"ERR_MODULE_NOT_FOUND\" &&\n      err.code !== \"MODULE_NOT_FOUND\" &&\n      err.code !== \"UNDECLARED_DEPENDENCY\"\n    ) {\n      throw err;\n    }\n\n    // passthrough IPC only if babel-node itself has an IPC channel\n    const shouldPassthroughIPC = process.send !== undefined;\n    const proc = child_process.spawn(process.argv[0], args, {\n      stdio: shouldPassthroughIPC\n        ? [\"inherit\", \"inherit\", \"inherit\", \"ipc\"]\n        : \"inherit\",\n    });\n    proc.on(\"exit\", function (code, signal) {\n      process.on(\"exit\", function () {\n        if (signal) {\n          process.kill(process.pid, signal);\n        } else {\n          process.exitCode = code ?? undefined;\n        }\n      });\n    });\n    if (shouldPassthroughIPC) {\n      proc.on(\"message\", message => process.send(message));\n    }\n    process.on(\"SIGINT\", () => proc.kill(\"SIGINT\"));\n    process.on(\"SIGTERM\", () => proc.kill(\"SIGTERM\"));\n  }\n});\n"],"mappings":"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"}